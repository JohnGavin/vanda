---
title: "Medium: Data Extraction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Medium: Data Extraction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(vanda)
library(dplyr)
library(tibble)
library(knitr)
```

## Data Extraction

This vignette shows how to extract detailed information for specific objects found in a search and perform multi-criteria tabulation.

```{r search}
client <- mcp_connect()
results <- mcp_search(client, "Textile")
```

## Extracting Details

Let's extract details for the top 3 most popular items.

```{r extract}
top_items <- results |>
  arrange(desc(popularity)) |>
  head(3)

details_list <- lapply(top_items$id, function(id) {
  mcp_extract(client, id)
})

# Convert list to data frame for display
details_df <- bind_rows(details_list)
kable(details_df, caption = "Top 3 Popular Items Details")
```

## Advanced Tabulation

We can tabulate the results by multiple categories such as **Period**, **Genre**, and **Popularity** ranges.

### Tabulate by Period and Genre

```{r tabulate-period-genre}
summary_table <- results |>
  group_by(period, genre) |>
  summarise(
    count = n(),
    avg_pop = mean(popularity),
    .groups = "drop"
  ) |>
  arrange(desc(avg_pop))

kable(summary_table, caption = "Summary by Period and Genre")
```

### Tabulate by Popularity Deciles

```{r tabulate-popularity}
pop_table <- results |>
  mutate(pop_bracket = cut(popularity, breaks = seq(0, 100, by = 25))) |>
  group_by(pop_bracket) |>
  summarise(
    item_count = n(),
    genres = paste(unique(genre), collapse = ", ")
  )

kable(pop_table, caption = "Items grouped by Popularity Bracket")
```

## Session Info

```{r session-info}
sessionInfo()
```
